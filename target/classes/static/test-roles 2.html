<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test des Rôles</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        pre { background-color: #f5f5f5; padding: 10px; border-radius: 5px; }
        button { margin: 10px 0; padding: 8px 15px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Vérification des Rôles</h1>
    
    <div>
        <h2>Informations sur l'utilisateur connecté</h2>
        <pre id="userInfo">Chargement...</pre>
        <button onclick="checkUser()">Vérifier l'utilisateur</button>
    </div>
    
    <div>
        <h2>Actions</h2>
        <button onclick="window.location.href='/compte.html'">Tenter d'accéder à compte.html</button>
        <button onclick="window.location.href='/home.html'">Retour à l'accueil</button>
        <button onclick="logout()">Se déconnecter</button>
    </div>
    
    <script>
        function checkUser() {
            const token = sessionStorage.getItem("jwtToken");
            
            if (!token) {
                document.getElementById("userInfo").textContent = "Non connecté";
                return;
            }
            
            // Décoder le token JWT (partie payload)
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const payload = JSON.parse(window.atob(base64));
                
                // Afficher le contenu du token
                document.getElementById("userInfo").textContent = 
                    "Payload du token:\n" + JSON.stringify(payload, null, 2);
                
                // Vérifier les rôles depuis le serveur
                fetch("/api/auth/check-roles", {
                    headers: {
                        "Authorization": "Bearer " + token
                    }
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("userInfo").textContent += 
                        "\n\nRôles depuis le serveur:\n" + JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    document.getElementById("userInfo").textContent += 
                        "\n\nErreur: " + error.message;
                });
            } catch (e) {
                document.getElementById("userInfo").textContent = 
                    "Erreur lors du décodage du token: " + e.message;
            }
        }
        
        function logout() {
            sessionStorage.removeItem("jwtToken");
            window.location.href = "/connexion.html";
        }
        
        // Vérifier automatiquement au chargement
        checkUser();
    </script>
</body>
</html>
